<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1400 1000" width="1400" height="1000">
  <defs>
    <style>
      .title { font: bold 24px Arial; fill: #1e3a5f; }
      .subtitle { font: 14px Arial; fill: #666; }
      .component-label { font: bold 12px Arial; fill: #333; }
      .pin-label { font: 10px Arial; fill: #333; }
      .wire-label { font: 9px Arial; fill: #666; }
      .section-label { font: bold 14px Arial; fill: white; }
      .warning { font: bold 10px Arial; fill: #dc2626; }
      .note { font: italic 10px Arial; fill: #666; }
    </style>
    <!-- Component symbols -->
    <marker id="arrowhead" markerWidth="10" markerHeight="7" refX="9" refY="3.5" orient="auto">
      <polygon points="0 0, 10 3.5, 0 7" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="1400" height="1000" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="700" y="35" text-anchor="middle" class="title">INSPECTAIR - Schaltplan</text>
  <text x="700" y="55" text-anchor="middle" class="subtitle">ESP32-S3 Luftqualitätssensor | DHBW Ravensburg | Version 2.0</text>
  
  <!-- ==================== ESP32-S3 (Center) ==================== -->
  <g transform="translate(550, 200)">
    <rect x="0" y="0" width="300" height="500" rx="10" fill="#1e3a5f" stroke="#0f172a" stroke-width="2"/>
    <text x="150" y="30" text-anchor="middle" class="section-label">ESP32-S3-WROOM N8R8</text>
    <text x="150" y="50" text-anchor="middle" style="font: 11px Arial; fill: #94a3b8;">(Waveshare DevKit)</text>
    
    <!-- USB -->
    <rect x="120" y="480" width="60" height="25" rx="3" fill="#374151"/>
    <text x="150" y="497" text-anchor="middle" style="font: 9px Arial; fill: white;">USB-C</text>
    
    <!-- Left side pins -->
    <g fill="#22c55e" style="font: 9px monospace; fill: white;">
      <!-- Power -->
      <rect x="-5" y="80" width="50" height="18" rx="2" fill="#dc2626"/>
      <text x="20" y="93" text-anchor="middle">3.3V</text>
      <rect x="-5" y="105" width="50" height="18" rx="2" fill="#dc2626"/>
      <text x="20" y="118" text-anchor="middle">5V</text>
      <rect x="-5" y="130" width="50" height="18" rx="2" fill="#1f2937"/>
      <text x="20" y="143" text-anchor="middle">GND</text>
      
      <!-- I2C -->
      <rect x="-5" y="170" width="50" height="18" rx="2" fill="#0ea5e9"/>
      <text x="20" y="183" text-anchor="middle">GPIO8</text>
      <rect x="-5" y="195" width="50" height="18" rx="2" fill="#0ea5e9"/>
      <text x="20" y="208" text-anchor="middle">GPIO9</text>
      
      <!-- Display SPI -->
      <rect x="-5" y="240" width="50" height="18" rx="2" fill="#8b5cf6"/>
      <text x="20" y="253" text-anchor="middle">GPIO10</text>
      <rect x="-5" y="265" width="50" height="18" rx="2" fill="#8b5cf6"/>
      <text x="20" y="278" text-anchor="middle">GPIO11</text>
      <rect x="-5" y="290" width="50" height="18" rx="2" fill="#8b5cf6"/>
      <text x="20" y="303" text-anchor="middle">GPIO12</text>
      <rect x="-5" y="315" width="50" height="18" rx="2" fill="#8b5cf6"/>
      <text x="20" y="328" text-anchor="middle">GPIO13</text>
      <rect x="-5" y="340" width="50" height="18" rx="2" fill="#8b5cf6"/>
      <text x="20" y="353" text-anchor="middle">GPIO14</text>
      
      <!-- Button -->
      <rect x="-5" y="385" width="50" height="18" rx="2" fill="#f59e0b"/>
      <text x="20" y="398" text-anchor="middle">GPIO0</text>
      
      <!-- MOSFET -->
      <rect x="-5" y="420" width="50" height="18" rx="2" fill="#ec4899"/>
      <text x="20" y="433" text-anchor="middle">GPIO21</text>
    </g>
    
    <!-- Right side pins -->
    <g style="font: 9px monospace; fill: white;">
      <!-- CO2 UART -->
      <rect x="255" y="80" width="50" height="18" rx="2" fill="#22c55e"/>
      <text x="280" y="93" text-anchor="middle">GPIO15</text>
      <rect x="255" y="105" width="50" height="18" rx="2" fill="#22c55e"/>
      <text x="280" y="118" text-anchor="middle">GPIO16</text>
      
      <!-- PMS UART -->
      <rect x="255" y="150" width="50" height="18" rx="2" fill="#84cc16"/>
      <text x="280" y="163" text-anchor="middle">GPIO17</text>
      <rect x="255" y="175" width="50" height="18" rx="2" fill="#84cc16"/>
      <text x="280" y="188" text-anchor="middle">GPIO18</text>
      
      <!-- Radar UART -->
      <rect x="255" y="220" width="50" height="18" rx="2" fill="#f97316"/>
      <text x="280" y="233" text-anchor="middle">GPIO6</text>
      <rect x="255" y="245" width="50" height="18" rx="2" fill="#f97316"/>
      <text x="280" y="258" text-anchor="middle">GPIO7</text>
    </g>
  </g>
  
  <!-- ==================== Display ST7796S (Left Top) ==================== -->
  <g transform="translate(50, 120)">
    <rect x="0" y="0" width="180" height="200" rx="8" fill="#8b5cf6" stroke="#6d28d9" stroke-width="2"/>
    <text x="90" y="25" text-anchor="middle" class="section-label">ST7796S Display</text>
    <text x="90" y="42" text-anchor="middle" style="font: 10px Arial; fill: #e0e7ff;">4" TFT 480x320 (SPI)</text>
    
    <!-- Display screen -->
    <rect x="20" y="55" width="140" height="90" rx="3" fill="#1e293b"/>
    <text x="90" y="105" text-anchor="middle" style="font: 12px Arial; fill: #60a5fa;">InspectAir UI</text>
    
    <!-- Pins -->
    <g style="font: 8px Arial; fill: white;">
      <text x="15" y="165">VCC→3.3V</text>
      <text x="15" y="178">GND→GND</text>
      <text x="100" y="165">CS→GPIO14</text>
      <text x="100" y="178">DC→GPIO13</text>
      <text x="100" y="191">RST→GPIO10</text>
    </g>
  </g>
  
  <!-- Display wires -->
  <g stroke-width="2" fill="none">
    <path d="M230 180 L520 289" stroke="#8b5cf6"/>
    <path d="M230 195 L520 264" stroke="#8b5cf6"/>
    <path d="M230 210 L520 314" stroke="#8b5cf6"/>
    <path d="M230 225 L520 339" stroke="#8b5cf6"/>
    <path d="M230 240 L520 249" stroke="#8b5cf6"/>
  </g>
  <text x="350" y="220" class="wire-label">SPI Bus</text>
  <text x="350" y="235" class="wire-label">(MOSI, CLK, CS, DC, RST)</text>
  
  <!-- ==================== I2C Sensors (Left Middle) ==================== -->
  <g transform="translate(50, 380)">
    <!-- AHT20 -->
    <rect x="0" y="0" width="100" height="80" rx="5" fill="#0ea5e9" stroke="#0284c7" stroke-width="2"/>
    <text x="50" y="20" text-anchor="middle" class="section-label">AHT20</text>
    <text x="50" y="38" text-anchor="middle" style="font: 9px Arial; fill: #e0f2fe;">Temp+Feuchte</text>
    <text x="50" y="55" text-anchor="middle" style="font: 8px Arial; fill: #bae6fd;">I2C: 0x38</text>
    <text x="50" y="72" text-anchor="middle" style="font: 8px Arial; fill: #bae6fd;">3.3V</text>
    
    <!-- SGP40 -->
    <rect x="110" y="0" width="100" height="80" rx="5" fill="#0ea5e9" stroke="#0284c7" stroke-width="2"/>
    <text x="160" y="20" text-anchor="middle" class="section-label">SGP40</text>
    <text x="160" y="38" text-anchor="middle" style="font: 9px Arial; fill: #e0f2fe;">VOC Index</text>
    <text x="160" y="55" text-anchor="middle" style="font: 8px Arial; fill: #bae6fd;">I2C: 0x59</text>
    <text x="160" y="72" text-anchor="middle" style="font: 8px Arial; fill: #bae6fd;">3.3V</text>
    
    <!-- I2C Bus indicator -->
    <rect x="0" y="90" width="210" height="25" rx="3" fill="#0369a1"/>
    <text x="105" y="107" text-anchor="middle" style="font: 10px Arial; fill: white;">I²C Bus (SDA: GPIO8, SCL: GPIO9)</text>
  </g>
  
  <!-- I2C wires -->
  <g stroke="#0ea5e9" stroke-width="2" fill="none">
    <path d="M260 470 L520 378"/>
    <path d="M260 485 L520 403"/>
  </g>
  <text x="380" y="400" class="wire-label">4.7kΩ Pull-ups!</text>
  
  <!-- ==================== UART Sensors (Right Side) ==================== -->
  
  <!-- MH-Z19C CO2 -->
  <g transform="translate(1000, 100)">
    <rect x="0" y="0" width="160" height="100" rx="5" fill="#22c55e" stroke="#16a34a" stroke-width="2"/>
    <text x="80" y="22" text-anchor="middle" class="section-label">MH-Z19C</text>
    <text x="80" y="40" text-anchor="middle" style="font: 10px Arial; fill: #dcfce7;">CO₂ Sensor</text>
    <text x="80" y="58" text-anchor="middle" style="font: 9px Arial; fill: #bbf7d0;">UART 9600</text>
    <text x="80" y="75" text-anchor="middle" style="font: 9px Arial; fill: #bbf7d0;">TX→GPIO16, RX→GPIO15</text>
    <text x="80" y="92" text-anchor="middle" style="font: 9px Arial; fill: #fef08a;">⚡ 5V + 220µF!</text>
  </g>
  
  <!-- CO2 wires -->
  <g stroke="#22c55e" stroke-width="2" fill="none">
    <path d="M1000 140 L880 289"/>
    <path d="M1000 155 L880 314"/>
  </g>
  
  <!-- PMS5003 Feinstaub -->
  <g transform="translate(1000, 230)">
    <rect x="0" y="0" width="160" height="100" rx="5" fill="#84cc16" stroke="#65a30d" stroke-width="2"/>
    <text x="80" y="22" text-anchor="middle" class="section-label">PMS5003</text>
    <text x="80" y="40" text-anchor="middle" style="font: 10px Arial; fill: #ecfccb;">Feinstaub PM2.5</text>
    <text x="80" y="58" text-anchor="middle" style="font: 9px Arial; fill: #d9f99d;">UART 9600</text>
    <text x="80" y="75" text-anchor="middle" style="font: 9px Arial; fill: #d9f99d;">TX→GPIO18, RX→GPIO17</text>
    <text x="80" y="92" text-anchor="middle" style="font: 9px Arial; fill: #d9f99d;">5V (Molex)</text>
  </g>
  
  <!-- PMS wires -->
  <g stroke="#84cc16" stroke-width="2" fill="none">
    <path d="M1000 270 L880 359"/>
    <path d="M1000 285 L880 384"/>
  </g>
  
  <!-- LD2410C Radar -->
  <g transform="translate(1000, 360)">
    <rect x="0" y="0" width="160" height="130" rx="5" fill="#f97316" stroke="#ea580c" stroke-width="2"/>
    <text x="80" y="22" text-anchor="middle" class="section-label">LD2410C</text>
    <text x="80" y="40" text-anchor="middle" style="font: 10px Arial; fill: #fed7aa;">24GHz Radar</text>
    <text x="80" y="58" text-anchor="middle" style="font: 9px Arial; fill: #fdba74;">UART 256000</text>
    <text x="80" y="75" text-anchor="middle" style="font: 9px Arial; fill: #fdba74;">TX→Level Shifter→GPIO6</text>
    <text x="80" y="92" text-anchor="middle" style="font: 9px Arial; fill: #fdba74;">RX→GPIO7, OUT→GPIO15</text>
    
    <!-- Warning box -->
    <rect x="10" y="100" width="140" height="22" rx="2" fill="#fef2f2" stroke="#dc2626"/>
    <text x="80" y="115" text-anchor="middle" class="warning">⚠️ Level Shifter + 220µF!</text>
  </g>
  
  <!-- Radar wires with level shifter -->
  <g stroke="#f97316" stroke-width="2" fill="none">
    <path d="M1000 420 L940 420 L940 450 L880 428"/>
    <path d="M1000 440 L880 453"/>
  </g>
  
  <!-- Level Shifter Box -->
  <g transform="translate(900, 510)">
    <rect x="0" y="0" width="130" height="60" rx="5" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="65" y="20" text-anchor="middle" style="font: bold 10px Arial; fill: #92400e;">LEVEL SHIFTER</text>
    <text x="65" y="35" text-anchor="middle" style="font: 9px Arial; fill: #a16207;">5V → 3.3V</text>
    <text x="65" y="50" text-anchor="middle" style="font: 9px Arial; fill: #a16207;">Bidirektional</text>
  </g>
  
  <!-- ==================== MOSFET Backlight Circuit (Bottom Left) ==================== -->
  <g transform="translate(50, 600)">
    <rect x="0" y="0" width="350" height="140" rx="8" fill="#fdf4ff" stroke="#d946ef" stroke-width="2"/>
    <text x="175" y="25" text-anchor="middle" style="font: bold 12px Arial; fill: #86198f;">Backlight PWM-Steuerung</text>
    
    <!-- MOSFET Symbol -->
    <g transform="translate(80, 50)">
      <rect x="0" y="0" width="60" height="50" rx="3" fill="#ec4899"/>
      <text x="30" y="18" text-anchor="middle" style="font: bold 10px Arial; fill: white;">BS170</text>
      <text x="30" y="32" text-anchor="middle" style="font: 8px Arial; fill: white;">N-MOSFET</text>
      <text x="30" y="45" text-anchor="middle" style="font: 8px Arial; fill: white;">Logic Level</text>
    </g>
    
    <!-- Connections -->
    <text x="50" y="70" style="font: 9px Arial; fill: #333;">GPIO21</text>
    <path d="M75 70 L80 70" stroke="#ec4899" stroke-width="2"/>
    
    <text x="175" y="55" style="font: 9px Arial; fill: #333;">1kΩ</text>
    <rect x="165" y="60" width="30" height="10" rx="2" fill="#a3a3a3"/>
    
    <text x="220" y="70" style="font: 9px Arial; fill: #333;">Gate</text>
    <text x="220" y="90" style="font: 9px Arial; fill: #333;">Drain → Display BL-</text>
    <text x="220" y="110" style="font: 9px Arial; fill: #333;">Source → GND</text>
    
    <text x="175" y="135" text-anchor="middle" style="font: italic 9px Arial; fill: #666;">PWM 5kHz, 0-100% Duty Cycle</text>
  </g>
  
  <!-- MOSFET wire -->
  <path d="M520 628 L400 650" stroke="#ec4899" stroke-width="2" fill="none"/>
  
  <!-- ==================== Button (Bottom Center) ==================== -->
  <g transform="translate(450, 780)">
    <rect x="0" y="0" width="100" height="70" rx="5" fill="#f59e0b" stroke="#d97706" stroke-width="2"/>
    <text x="50" y="22" text-anchor="middle" class="section-label">BUTTON</text>
    <text x="50" y="42" text-anchor="middle" style="font: 9px Arial; fill: #fef3c7;">GPIO0 (Boot)</text>
    <text x="50" y="58" text-anchor="middle" style="font: 9px Arial; fill: #fef3c7;">Interner Pull-up</text>
  </g>
  
  <!-- Button wire -->
  <path d="M550 593 L500 780" stroke="#f59e0b" stroke-width="2" fill="none"/>
  
  <!-- ==================== Power Section (Bottom Right) ==================== -->
  <g transform="translate(900, 620)">
    <rect x="0" y="0" width="200" height="160" rx="8" fill="#fee2e2" stroke="#dc2626" stroke-width="2"/>
    <text x="100" y="25" text-anchor="middle" style="font: bold 12px Arial; fill: #991b1b;">⚡ Stromversorgung</text>
    
    <text x="20" y="50" style="font: 10px Arial; fill: #333;">USB 5V → ESP32 → 3.3V Regler</text>
    
    <text x="20" y="75" style="font: bold 10px Arial; fill: #dc2626;">5V Verbraucher:</text>
    <text x="30" y="92" style="font: 9px Arial; fill: #333;">• MH-Z19C (CO₂)</text>
    <text x="30" y="107" style="font: 9px Arial; fill: #333;">• PMS5003 (Feinstaub)</text>
    <text x="30" y="122" style="font: 9px Arial; fill: #333;">• LD2410C (Radar)</text>
    
    <rect x="20" y="135" width="160" height="18" rx="2" fill="#fef08a" stroke="#ca8a04"/>
    <text x="100" y="148" text-anchor="middle" style="font: bold 9px Arial; fill: #854d0e;">220µF @ CO2 + Radar!</text>
  </g>
  
  <!-- ==================== Legend ==================== -->
  <g transform="translate(50, 850)">
    <rect x="0" y="0" width="800" height="100" rx="5" fill="white" stroke="#e5e7eb" stroke-width="1"/>
    <text x="400" y="22" text-anchor="middle" style="font: bold 12px Arial; fill: #333;">Legende</text>
    
    <!-- Wire colors -->
    <g transform="translate(30, 40)">
      <rect x="0" y="0" width="15" height="15" fill="#8b5cf6"/>
      <text x="22" y="12" style="font: 10px Arial;">SPI (Display)</text>
      
      <rect x="100" y="0" width="15" height="15" fill="#0ea5e9"/>
      <text x="122" y="12" style="font: 10px Arial;">I²C (AHT20, SGP40)</text>
      
      <rect x="230" y="0" width="15" height="15" fill="#22c55e"/>
      <text x="252" y="12" style="font: 10px Arial;">UART (CO₂)</text>
      
      <rect x="330" y="0" width="15" height="15" fill="#84cc16"/>
      <text x="352" y="12" style="font: 10px Arial;">UART (Feinstaub)</text>
      
      <rect x="450" y="0" width="15" height="15" fill="#f97316"/>
      <text x="472" y="12" style="font: 10px Arial;">UART (Radar)</text>
      
      <rect x="570" y="0" width="15" height="15" fill="#ec4899"/>
      <text x="592" y="12" style="font: 10px Arial;">PWM (Backlight)</text>
      
      <rect x="690" y="0" width="15" height="15" fill="#f59e0b"/>
      <text x="712" y="12" style="font: 10px Arial;">GPIO (Button)</text>
    </g>
    
    <!-- Critical notes -->
    <g transform="translate(30, 70)">
      <text x="0" y="0" style="font: bold 10px Arial; fill: #dc2626;">⚠️ KRITISCH:</text>
      <text x="80" y="0" style="font: 10px Arial; fill: #333;">Level Shifter für LD2410C TX obligatorisch! | 220µF Elkos an CO₂ + Radar VCC | 4.7kΩ Pull-ups am I²C Bus</text>
    </g>
  </g>
  
  <!-- ==================== Pin Summary Table ==================== -->
  <g transform="translate(1150, 100)">
    <rect x="0" y="0" width="200" height="380" rx="5" fill="white" stroke="#e5e7eb" stroke-width="1"/>
    <rect x="0" y="0" width="200" height="30" rx="5" fill="#1e3a5f"/>
    <text x="100" y="20" text-anchor="middle" style="font: bold 11px Arial; fill: white;">GPIO Übersicht</text>
    
    <g style="font: 9px monospace; fill: #333;">
      <text x="10" y="50">GPIO0  → Button</text>
      <text x="10" y="68">GPIO6  → Radar RX (LS!)</text>
      <text x="10" y="86">GPIO7  → Radar TX</text>
      <text x="10" y="104">GPIO8  → I2C SDA</text>
      <text x="10" y="122">GPIO9  → I2C SCL</text>
      <text x="10" y="140">GPIO10 → TFT RST</text>
      <text x="10" y="158">GPIO11 → TFT MOSI</text>
      <text x="10" y="176">GPIO12 → TFT CLK</text>
      <text x="10" y="194">GPIO13 → TFT DC</text>
      <text x="10" y="212">GPIO14 → TFT CS</text>
      <text x="10" y="230">GPIO15 → CO2 TX / Radar OUT</text>
      <text x="10" y="248">GPIO16 → CO2 RX</text>
      <text x="10" y="266">GPIO17 → PMS RX</text>
      <text x="10" y="284">GPIO18 → PMS TX</text>
      <text x="10" y="302">GPIO21 → Backlight PWM</text>
    </g>
    
    <line x1="10" y1="320" x2="190" y2="320" stroke="#e5e7eb"/>
    <text x="100" y="340" text-anchor="middle" style="font: bold 9px Arial; fill: #666;">Spannung</text>
    <text x="10" y="358" style="font: 9px Arial; fill: #333;">3.3V: Display, AHT20, SGP40</text>
    <text x="10" y="373" style="font: 9px Arial; fill: #333;">5V: CO₂, PMS, Radar</text>
  </g>
  
  <!-- Footer -->
  <text x="700" y="985" text-anchor="middle" style="font: 10px Arial; fill: #999;">InspectAir Schaltplan v2.0 | Januar 2026 | Team: Maxi, Jannis, Cedric | DHBW Ravensburg</text>
</svg>
